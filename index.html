<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音に合わせて当ててみましょう</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f0f2f5;
            margin: 0;
        }

        h1 {
            color: #333;
        }

        /* --- スタート画面 --- */
        #start-screen {
            text-align: center;
        }

        #last-score {
            font-size: 1.5rem;
            color: #333;
            font-weight: bold;
            margin-bottom: 20px;
        }

        /* ★追加：モード選択ボタンのコンテナ */
        #mode-selection {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        /* ★変更：スタートボタンのスタイルを共通化 */
        .start-button {
            font-size: 1.2rem; /* 少し小さくして2つ並べる */
            padding: 15px 30px;
            border-radius: 10px;
            border: none;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        /* ★追加：ボタンの色分け */
        #start-button-sound {
            background-color: #007bff; /* 青 */
        }
        #start-button-sound:hover {
            background-color: #0056b3;
        }
        #start-button-silent {
            background-color: #28a745; /* 緑 */
        }
        #start-button-silent:hover {
            background-color: #1e7e34;
        }


        /* --- クイズ画面 --- */
        #quiz-screen {
            width: 90%;
            max-width: 800px;
        }
        
        /* ★追加：クイズタイトル（H2） */
        #quiz-title {
            text-align: center;
            color: #555;
            font-size: 1.8rem;
        }

        #timer {
            font-size: 3rem;
            font-weight: bold;
            color: #d9534f;
            text-align: center;
            margin-bottom: 20px;
        }

        #video-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            border: 5px solid #ccc;
            border-radius: 10px;
            padding: 15px;
            background-color: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        video {
            width: 100%;
            aspect-ratio: 16 / 9;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        video:hover {
            transform: scale(1.03);
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.7);
        }

        #result {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
        }

        /* --- ユーティリティクラス --- */
        .hidden {
            display: none;
        }

        .correct {
            color: #28a745;
            background-color: #e6f7ec;
            border: 2px solid #28a745;
        }

        .incorrect {
            color: #dc3545;
            background-color: #fbebee;
            border: 2px solid #dc3545;
        }
    </style>
</head>
<body>

    <h1>音に合わせて当ててみましょう</h1>

    <div id="start-screen">
        <h2>モードを選んでください</h2>
        <p id="last-score" class="hidden"></p>
        
        <div id="mode-selection">
            <button id="start-button-sound" class="start-button">金星の真島茂樹モード</button>
            <button id="start-button-silent" class="start-button">金星の真島茂樹どもモード</button>
        </div>
    </div>

    <div id="quiz-screen" class="hidden">
        <h2 id="quiz-title"></h2>
        
        <div id="timer">10</div>
        <div id="video-grid">
            <video id="v0" loop playsinline></video>
            <video id="v1" loop playsinline></video>
            <video id="v2" loop playsinline></video>
            <video id="v3" loop playsinline></video>
        </div>
        <div id="result" class="hidden"></div>
    </div>

    <script>
        // --- 設定 ---
        const TIME_LIMIT = 10;
        const RESULT_DELAY = 1500; 

        // 使用する動画のリスト
        const videoSources = [
            "Dance to the rhythm of the Dance of Venus.mp4",
            "Let's dance to the rhythm of Venus' samba (JapaneseDub).mp4",
            "いい音が鳴ると体がサーフィンしちゃうんですよ.mp4",
            "それでは一緒に踊ってみましょう.mp4",
            "ターボビクスの組み合わせとってもいいでしょ？.mp4",
            "ダイナミックに踊ってみましょう.mp4",
            "マジーのダンスと言えばお馴染みのアレ.mp4",
            "ラテンのリズムで元気よく踊るマンボバージョン.mp4",
            "リズムに合わせてさあ踊ろう.mp4",
            "勇気を出して踊ってみましょう.mp4",
            "天保山でマジーと踊ろう.mp4",
            "家族みんなで踊ってくださいね.mp4",
            "後はゴージャスに踊ってみましょう.mp4",
            "感動する勇気を出して踊ってみましょう.mp4",
            "真島先生も一緒に踊ります.mp4",
            "私と一緒にターボビクス踊りましょうね.mp4",
            "腰元ダンサーに踊って頂きましょう.mp4",
            "音でいってみましょう.mp4",
            "音に合わしていってみましょう.mp4",
            "音に合わしていってみましょうね.mp4",
            "音に合わせていってみましょう.mp4",
            "音に合わせて元気よく.mp4",
            "音に合わせて踊ってみましょう.mp4",
            "音楽と一緒に踊ってみましょう.mp4",
            "音楽に合わせていってみましょう.mp4",
            "音楽に合わせてやってみましょう.mp4",
            "音楽に合わせてやってみましょう2.mp4",
            "音楽に合わせてやってみましょうね.mp4",
            "音楽に合わせて踊ってみましょう.mp4",
            "頭から通して踊ってみましょう.mp4"
        ];

        // --- DOM要素の取得 ---
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const timerEl = document.getElementById('timer');
        const resultEl = document.getElementById('result');
        const videos = document.querySelectorAll('#video-grid video');
        const lastScoreEl = document.getElementById('last-score');
        
        // ★追加：新しいDOM要素
        const startButtonSound = document.getElementById('start-button-sound');
        const startButtonSilent = document.getElementById('start-button-silent');
        const quizTitleEl = document.getElementById('quiz-title');

        // --- グローバル変数 ---
        let timerInterval = null;
        let timeLeft = TIME_LIMIT;
        let consecutiveWins = 0; 
        let currentQuizMode = 'findSound'; // ★追加：現在のクイズモード

        // --- イベントリスナー ---
        document.addEventListener('DOMContentLoaded', preloadVideos);
        
        // ★変更：モードごとにスタート関数を呼び出す
        startButtonSound.addEventListener('click', () => startGame('findSound'));
        startButtonSilent.addEventListener('click', () => startGame('findSilent'));

        // --- 関数 ---

        /**
         * 動画のメタデータを先行読み込みする
         */
        function preloadVideos() {
            console.log('Preloading video metadata...');
            videoSources.forEach(src => {
                const video = document.createElement('video');
                video.src = src;
                video.preload = 'metadata';
            });
        }

        /**
         * ★変更：クイズモードを指定して開始する
         * @param {string} mode - 'findSound' または 'findSilent'
         */
        function startGame(mode) {
            currentQuizMode = mode; // モードをグローバル変数に保存
            
            // クイズタイトルを設定
            if (currentQuizMode === 'findSound') {
                quizTitleEl.textContent = '音に合わせて(いる動画を)当ててみましょう';
            } else {
                quizTitleEl.textContent = '音に合わせて(いない動画を)当ててみましょう';
            }
            
            lastScoreEl.classList.add('hidden'); // スコア表示を隠す
            
            startScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            setupQuiz();
        }

        /**
         * 新しいクイズのラウンドをセットアップする
         */
        function setupQuiz() {
            resultEl.classList.add('hidden');
            resultEl.textContent = '';
            
            timeLeft = TIME_LIMIT;
            timerEl.textContent = timeLeft;
            timerEl.style.color = '#d9534f'; 

            // 正解（または不正解）の動画をランダムに決定
            const correctIndex = Math.floor(Math.random() * 4);
            const selectedVideos = shuffleArray(videoSources).slice(0, 4);

            videos.forEach((video, index) => {
                video.src = selectedVideos[index];
                video.currentTime = 0; 

                // ★変更：クイズモードに基づいてミュート設定を決定
                if (currentQuizMode === 'findSound') {
                    // 「音あり」を探すモード（従来通り）
                    // 正解(correctIndex)だけミュートを解除
                    video.muted = (index !== correctIndex);
                } else {
                    // 「音なし」を探すモード（逆）
                    // 正解(correctIndex)だけミュート
                    video.muted = (index === correctIndex);
                }
                
                video.play().catch(e => {
                    console.warn("Autoplay failed:", e);
                });

                video.removeEventListener('click', handleVideoClick);
                video.addEventListener('click', handleVideoClick);
            });

            timerInterval = setInterval(updateTimer, 1000);
        }

        /**
         * タイマーを1秒進める
         */
        function updateTimer() {
            timeLeft--;
            timerEl.textContent = timeLeft;

            if (timeLeft <= 3) {
                timerEl.style.color = 'red';
            }

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                showResult(false, "時間切れ！");
                cleanupAndNext(false);
            }
        }

        /**
         * 動画がクリックされたときの処理
         */
        function handleVideoClick(event) {
            clearInterval(timerInterval);

            // ★変更：クイズモードに基づいて正解判定
            let isCorrect;
            if (currentQuizMode === 'findSound') {
                // 「音あり」モード：ミュートされてない(false)のが正解
                isCorrect = !event.currentTarget.muted;
            } else {
                // 「音なし」モード：ミュートされている(true)のが正解
                isCorrect = event.currentTarget.muted;
            }
            
            showResult(isCorrect);
            cleanupAndNext(isCorrect);
        }

        /**
         * 正解・不正解を表示する
         */
        function showResult(isCorrect, message = '') {
            resultEl.classList.remove('hidden', 'correct', 'incorrect');
            
            if (message) {
                resultEl.textContent = message;
                resultEl.classList.add('incorrect');
            } else if (isCorrect) {
                resultEl.textContent = '正解！';
                resultEl.classList.add('correct');
            } else {
                resultEl.textContent = '不正解...';
                resultEl.classList.add('incorrect');
            }
        }

        /**
         * ラウンド終了処理と次のアクションの分岐
         */
        function cleanupAndNext(wasCorrect) {
            videos.forEach(video => {
                video.pause();
                video.muted = true;
                video.removeEventListener('click', handleVideoClick);
            });

            if (wasCorrect) {
                consecutiveWins++;
                setTimeout(setupQuiz, RESULT_DELAY);
            } else {
                // 失敗時はスタート画面に戻る
                setTimeout(() => {
                    quizScreen.classList.add('hidden');
                    startScreen.classList.remove('hidden');
                    
                    lastScoreEl.textContent = `スコア: ${consecutiveWins} 点`;
                    lastScoreEl.classList.remove('hidden');
                    
                    consecutiveWins = 0; 
                }, RESULT_DELAY);
            }
        }

        /**
         * 配列をシャッフルする
         */
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

    </script>

</body>
</html>
